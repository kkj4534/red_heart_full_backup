🚀 Red Heart AI 통합 학습 시스템 시작
===========================================
[0;34m[INFO][0m 작업 디렉토리: /mnt/c/large_project/linux_red_heart
[0;34m[INFO][0m Red Heart AI 통합 환경 상태 확인 중...
[0;32m[SUCCESS][0m ✅ red_heart_env 가상환경 존재
[0;32m[SUCCESS][0m ✅ faiss-test conda 환경 존재
[0;32m[SUCCESS][0m ✅ FAISS 설치됨 및 작동 확인
✅ Red Heart AI 통합 환경 활성화 완료
   - venv: /mnt/c/large_project/linux_red_heart/red_heart_env
   - conda: faiss-test (함께 활성화됨)
   - python: /mnt/c/large_project/linux_red_heart/red_heart_env/bin/python
   - 환경 분리: faiss→conda subprocess, 나머지→venv
[0;32m[SUCCESS][0m ✅ 주요 패키지 (torch, transformers, numpy) 설치됨
[0;32m[SUCCESS][0m 🎉 모든 환경이 이미 준비되어 있습니다!
✅ Red Heart AI 통합 환경 활성화 완료
   - venv: /mnt/c/large_project/linux_red_heart/red_heart_env
   - conda: faiss-test (함께 활성화됨)
   - python: /mnt/c/large_project/linux_red_heart/red_heart_env/bin/python
   - 환경 분리: faiss→conda subprocess, 나머지→venv
[0;32m[SUCCESS][0m ✅ Red Heart AI 통합 환경 활성화 완료
[0;32m[SUCCESS][0m    - venv: /mnt/c/large_project/linux_red_heart/red_heart_env
[0;32m[SUCCESS][0m    - conda: faiss-test 환경 준비됨
[0;32m[SUCCESS][0m    - python: /mnt/c/large_project/linux_red_heart/red_heart_env/bin/python
[0;32m[SUCCESS][0m    - 환경 분리: faiss→conda subprocess, 나머지→venv
[0;34m[INFO][0m 🔐 HuggingFace 오프라인 모드 활성화 (캐시된 모델만 사용)
[0;34m[INFO][0m Red Heart AI 통합 학습 시스템 시작
[0;34m[INFO][0m 환경 분리: conda(faiss) + venv(transformers,torch)
[0;34m[INFO][0m Red Heart AI 통합 학습 시스템 실행 시작...
[0;34m[INFO][0m 실행 모드: unified-test
[0;34m[INFO][0m 🧪 730M 최종 통합 시스템 학습 테스트 모드...
[0;34m[INFO][0m    - 60 에폭 학습 테스트 (--samples로 제한 가능)
[0;34m[INFO][0m    - LR 스윕, Sweet Spot, Parameter Crossover 포함
[0;34m[INFO][0m    - Advanced Training Techniques 활성화
[0;34m[INFO][0m 🔍 Hierarchical LR Sweep (5-5-5-5) 실행 모드
[0;34m[INFO][0m    - 25개 포인트로 최적 LR 탐색
[0;34m[INFO][0m    - 각 LR은 독립적으로 초기 가중치에서 시작
2025-08-21 22:17:17,312 - __main__ - INFO - ================================================================================
2025-08-21 22:17:17,312 - __main__ - INFO - 🚀 독립적인 Hierarchical Learning Rate Sweep 시작
2025-08-21 22:17:17,313 - __main__ - INFO - ================================================================================
2025-08-21 22:17:17,399 - __main__ - INFO - Device: cuda
2025-08-21 22:17:17,441 - __main__ - INFO - GPU: NVIDIA GeForce RTX 2070 SUPER
2025-08-21 22:17:17,441 - __main__ - INFO - GPU Memory: 8.6 GB
2025-08-21 22:17:17,442 - __main__ - INFO - 
📊 모델 설정:
2025-08-21 22:17:17,442 - __main__ - INFO -   - d_model: 896
2025-08-21 22:17:17,443 - __main__ - INFO -   - num_heads: 16
2025-08-21 22:17:17,443 - __main__ - INFO -   - num_layers: 6
2025-08-21 22:17:17,443 - __main__ - INFO -   - dropout: 0.1
2025-08-21 22:17:17,444 - __main__ - INFO - 
🔧 모델 생성 중...
/mnt/c/large_project/linux_red_heart/red_heart_env/lib/python3.12/site-packages/torch/nn/modules/transformer.py:379: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.norm_first was True
  warnings.warn(
2025-08-21 22:17:17,962 - unified_backbone - INFO - 백본 총 파라미터: 90,624,132 (90.62M)
2025-08-21 22:17:17,963 - unified_backbone - INFO - 학습 가능 파라미터: 90,624,132 (90.62M)
2025-08-21 22:17:18,166 - unified_heads - INFO - 감정 헤드 파라미터: 17,254,583 (17.25M)
2025-08-21 22:17:18,276 - unified_heads - INFO - 벤담 헤드 파라미터: 13,871,919 (13.87M)
2025-08-21 22:17:18,428 - unified_heads - INFO - 후회 헤드 파라미터: 19,897,161 (19.90M)
2025-08-21 22:17:18,521 - unified_heads - INFO - SURD 헤드 파라미터: 12,025,739 (12.03M)
2025-08-21 22:17:19,428 - analyzer_neural_modules - INFO - NeuralEmotionAnalyzer 초기화: 122,595,407 파라미터
2025-08-21 22:17:20,033 - analyzer_neural_modules - INFO - NeuralBenthamCalculator 초기화: 78,281,602 파라미터
2025-08-21 22:17:21,178 - analyzer_neural_modules - INFO - NeuralRegretAnalyzer 초기화: 153,872,666 파라미터
2025-08-21 22:17:21,280 - analyzer_neural_modules - INFO - NeuralSURDAnalyzer 초기화: 13,473,032 파라미터
2025-08-21 22:17:21,282 - analyzer_neural_modules - INFO - 전체 신경망 분석기 파라미터: 368,222,707 (368.2M)
2025-08-21 22:17:22,165 - emotion_dsp_simulator - INFO - EmotionDSPSimulator 초기화 완료 (~14M 파라미터)
2025-08-21 22:17:22,448 - __main__ - INFO -   - 총 파라미터: 539.9M
2025-08-21 22:17:22,449 - __main__ - INFO -   - 학습 가능 파라미터: 539.9M
2025-08-21 22:17:35,807 - __main__ - INFO -   - 초기 가중치 저장 완료
2025-08-21 22:17:35,807 - __main__ - INFO - 
📁 데이터 로더 생성 중...
2025-08-21 22:17:35,810 - __main__ - INFO - 🎯 임베딩 파일 발견: claude_api_preprocessing/claude_preprocessed_complete.embedded.json
2025-08-21 22:17:44,123 - __main__ - INFO -   - 전체 데이터: 10460개
2025-08-21 22:17:44,123 - __main__ - INFO -   - 전체 데이터: 10460개
2025-08-21 22:17:44,124 - __main__ - INFO -   - LR 스윕용 학습 데이터: 1000개
2025-08-21 22:17:44,124 - __main__ - INFO -   - LR 스윕용 검증 데이터: 100개
2025-08-21 22:17:44,124 - __main__ - INFO - 
🔄 전체 데이터 임베딩 생성 중...
2025-08-21 22:17:44,125 - __main__ - INFO - 📊 임베딩 상태:
2025-08-21 22:17:44,126 - __main__ - INFO -   - 전체 데이터: 10460개
2025-08-21 22:17:44,126 - __main__ - INFO -   - 임베딩 있음: 181개 (1.7%)
2025-08-21 22:17:44,126 - __main__ - INFO -   - 임베딩 없음: 10279개 (98.3%)
2025-08-21 22:17:44,127 - __main__ - WARNING - ⚠️ 10279개 항목에 임베딩이 없습니다. 자동 생성됩니다.
2025-08-21 22:17:44,128 - __main__ - INFO -   - 임베딩 생성 필요: 10279개 / 10460개
2025-08-21 22:17:44,128 - __main__ - INFO -   - 배치 처리 시작 (30개씩, 각 배치 타임아웃 13분)
2025-08-21 22:17:44,128 - __main__ - INFO - 
  📦 배치 1/349 처리 중...
2025-08-21 22:17:44,129 - __main__ - INFO -     - 범위: 0 ~ 29 (30개)
2025-08-21 22:17:44,129 - __main__ - INFO -     - 진행률: 0.0%
2025-08-21 22:17:44,129 - __main__ - INFO -     - 예상 남은 시간: 174.5분
2025-08-21 22:17:44,269 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:44,271 - __main__ - INFO - 
  📦 배치 2/349 처리 중...
2025-08-21 22:17:44,271 - __main__ - INFO -     - 범위: 30 ~ 59 (30개)
2025-08-21 22:17:44,272 - __main__ - INFO -     - 진행률: 0.3%
2025-08-21 22:17:44,272 - __main__ - INFO -     - 예상 남은 시간: 174.0분
2025-08-21 22:17:44,414 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:44,416 - __main__ - INFO - 
  📦 배치 3/349 처리 중...
2025-08-21 22:17:44,416 - __main__ - INFO -     - 범위: 60 ~ 89 (30개)
2025-08-21 22:17:44,417 - __main__ - INFO -     - 진행률: 0.6%
2025-08-21 22:17:44,417 - __main__ - INFO -     - 예상 남은 시간: 173.5분
2025-08-21 22:17:44,559 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:44,562 - __main__ - INFO - 
  📦 배치 4/349 처리 중...
2025-08-21 22:17:44,562 - __main__ - INFO -     - 범위: 90 ~ 119 (30개)
2025-08-21 22:17:44,562 - __main__ - INFO -     - 진행률: 0.9%
2025-08-21 22:17:44,563 - __main__ - INFO -     - 예상 남은 시간: 173.0분
2025-08-21 22:17:44,706 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:44,708 - __main__ - INFO - 
  📦 배치 5/349 처리 중...
2025-08-21 22:17:44,709 - __main__ - INFO -     - 범위: 120 ~ 149 (30개)
2025-08-21 22:17:44,709 - __main__ - INFO -     - 진행률: 1.1%
2025-08-21 22:17:44,709 - __main__ - INFO -     - 예상 남은 시간: 172.5분
2025-08-21 22:17:44,853 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:44,855 - __main__ - INFO - 
  📦 배치 6/349 처리 중...
2025-08-21 22:17:44,855 - __main__ - INFO -     - 범위: 150 ~ 179 (30개)
2025-08-21 22:17:44,856 - __main__ - INFO -     - 진행률: 1.4%
2025-08-21 22:17:44,856 - __main__ - INFO -     - 예상 남은 시간: 172.0분
2025-08-21 22:17:45,000 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.1초)
2025-08-21 22:17:45,003 - __main__ - INFO - 
  📦 배치 7/349 처리 중...
2025-08-21 22:17:45,003 - __main__ - INFO -     - 범위: 180 ~ 209 (30개)
2025-08-21 22:17:45,003 - __main__ - INFO -     - 진행률: 1.7%
2025-08-21 22:17:45,004 - __main__ - INFO -     - 예상 남은 시간: 171.5분
2025-08-21 22:17:45,012 - sentence_transformer_singleton - INFO - 새 클라이언트 생성 시작: sentence-transformers/all-MiniLM-L6-v2_cuda
2025-08-21 22:17:45,013 - sentence_transformer_client - INFO - 현재 Python이 venv 환경: /mnt/c/large_project/linux_red_heart/red_heart_env/bin/python
2025-08-21 22:17:45,013 - sentence_transformer_client - INFO - SentenceTransformer Client 초기화: /mnt/c/large_project/linux_red_heart/sentence_transformer_server.py
2025-08-21 22:17:45,014 - sentence_transformer_client - INFO - Python 실행파일: /mnt/c/large_project/linux_red_heart/red_heart_env/bin/python
2025-08-21 22:17:45,014 - sentence_transformer_singleton - INFO - 서버 시작 및 모델 로딩: sentence-transformers/all-MiniLM-L6-v2 (device: cuda)
2025-08-21 22:17:45,014 - sentence_transformer_client - INFO - SentenceTransformer 서버 시작: /mnt/c/large_project/linux_red_heart/sentence_transformer_server.py
2025-08-21 22:17:45,015 - sentence_transformer_client - INFO - PYTHONPATH: /mnt/c/large_project/linux_red_heart/red_heart_env/lib/python3.12/site-packages:/mnt/c/large_project/linux_red_heart
2025-08-21 22:17:45,015 - sentence_transformer_client - INFO - VIRTUAL_ENV: /mnt/c/large_project/linux_red_heart/red_heart_env
2025-08-21 22:17:55,712 - sentence_transformer_client - INFO - 서버 연결 성공
2025-08-21 22:17:55,712 - sentence_transformer_client - INFO - 모델 로딩 요청: sentence-transformers/all-MiniLM-L6-v2 (device: cuda)
2025-08-21 22:19:31,513 - sentence_transformer_client - INFO - 모델 로딩 성공: sentence-transformers/all-MiniLM-L6-v2
2025-08-21 22:19:31,513 - sentence_transformer_singleton - INFO - 클라이언트 생성 및 모델 로딩 성공: sentence-transformers/all-MiniLM-L6-v2_cuda
2025-08-21 22:19:32,443 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 107.4초)
2025-08-21 22:19:32,450 - __main__ - INFO - 
  📦 배치 8/349 처리 중...
2025-08-21 22:19:32,451 - __main__ - INFO -     - 범위: 210 ~ 239 (30개)
2025-08-21 22:19:32,451 - __main__ - INFO -     - 진행률: 2.0%
2025-08-21 22:19:32,451 - __main__ - INFO -     - 예상 남은 시간: 171.0분
2025-08-21 22:19:32,787 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.3초)
2025-08-21 22:19:32,794 - __main__ - INFO - 
  📦 배치 9/349 처리 중...
2025-08-21 22:19:32,795 - __main__ - INFO -     - 범위: 240 ~ 269 (30개)
2025-08-21 22:19:32,795 - __main__ - INFO -     - 진행률: 2.3%
2025-08-21 22:19:32,795 - __main__ - INFO -     - 예상 남은 시간: 170.5분
2025-08-21 22:19:33,126 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.3초)
2025-08-21 22:19:33,134 - __main__ - INFO - 
  📦 배치 10/349 처리 중...
2025-08-21 22:19:33,134 - __main__ - INFO -     - 범위: 270 ~ 299 (30개)
2025-08-21 22:19:33,134 - __main__ - INFO -     - 진행률: 2.6%
2025-08-21 22:19:33,135 - __main__ - INFO -     - 예상 남은 시간: 170.0분
2025-08-21 22:19:33,511 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.4초)
2025-08-21 22:19:33,514 - __main__ - INFO -   💾 중간 저장 중... (배치 10)
2025-08-21 22:19:56,801 - __main__ - INFO - ✅ 임베딩이 저장되었습니다: claude_api_preprocessing/claude_preprocessed_complete.embedded.json
2025-08-21 22:19:56,802 - __main__ - INFO -      저장 완료
2025-08-21 22:19:56,802 - __main__ - INFO - 
  📦 배치 11/349 처리 중...
2025-08-21 22:19:56,803 - __main__ - INFO -     - 범위: 300 ~ 329 (30개)
2025-08-21 22:19:56,803 - __main__ - INFO -     - 진행률: 2.9%
2025-08-21 22:19:56,803 - __main__ - INFO -     - 예상 남은 시간: 169.5분
2025-08-21 22:19:57,424 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.6초)
2025-08-21 22:19:57,432 - __main__ - INFO - 
  📦 배치 12/349 처리 중...
2025-08-21 22:19:57,432 - __main__ - INFO -     - 범위: 330 ~ 359 (30개)
2025-08-21 22:19:57,433 - __main__ - INFO -     - 진행률: 3.2%
2025-08-21 22:19:57,433 - __main__ - INFO -     - 예상 남은 시간: 169.0분
2025-08-21 22:19:57,935 - __main__ - INFO -     ✅ 배치 완료: 성공 30개 (소요시간: 0.5초)
2025-08-21 22:19:57,942 - __main__ - INFO - 
  📦 배치 13/349 처리 중...
2025-08-21 22:19:57,943 - __main__ - INFO -     - 범위: 360 ~ 389 (30개)
2025-08-21 22:19:57,943 - __main__ - INFO -     - 진행률: 3.4%
2025-08-21 22:19:57,944 - __main__ - INFO -     - 예상 남은 시간: 168.5분
2025-08-21 22:32:58,023 - sentence_transformer_client - ERROR - 요청 전송 실패: 응답 타임아웃 (780.0초)
2025-08-21 22:32:58,023 - sentence_transformer_client - ERROR - 요청 전송 실패: 응답 타임아웃 (780.0초)
2025-08-21 22:32:58,024 - __main__ - ERROR - ❌ 임베딩 생성 실패: 요청 실패 (재연결 없음): 응답 타임아웃 (780.0초)
2025-08-21 22:32:58,024 - __main__ - ERROR -     ❌ 임베딩 생성 실패 (idx=362): 임베딩 생성 실패: 요청 실패 (재연결 없음): 응답 타임아웃 (780.0초)
2025-08-21 22:32:58,025 - __main__ - ERROR - 
🔴 임베딩 생성 중 오류 발생. 프로세스 종료.
2025-08-21 22:32:58,026 - __main__ - ERROR -    - 성공: 362개
2025-08-21 22:32:58,026 - __main__ - ERROR -    - 실패: 1개
Traceback (most recent call last):
  File "/mnt/c/large_project/linux_red_heart/sentence_transformer_client.py", line 317, in send_request
    response = self._send_request_raw(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/large_project/linux_red_heart/sentence_transformer_client.py", line 291, in _send_request_raw
    raise TimeoutError(f"응답 타임아웃 ({timeout}초)")
TimeoutError: 응답 타임아웃 (780.0초)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/c/large_project/linux_red_heart/training/run_hierarchical_lr_sweep.py", line 95, in __getitem__
    embedding = self.embedding_manager.encode(text[:512])
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/large_project/linux_red_heart/sentence_transformer_singleton.py", line 274, in encode
    response = self.client.encode_texts(sentences, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/large_project/linux_red_heart/sentence_transformer_client.py", line 390, in encode_texts
    response = self.send_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/large_project/linux_red_heart/sentence_transformer_client.py", line 326, in send_request
    raise RuntimeError(f"요청 실패 (재연결 없음): {e}") from e
RuntimeError: 요청 실패 (재연결 없음): 응답 타임아웃 (780.0초)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/large_project/linux_red_heart/training/run_hierarchical_lr_sweep.py", line 313, in main
    _ = full_dataset[idx]  # 이 과정에서 임베딩이 생성됨
        ~~~~~~~~~~~~^^^^^
  File "/mnt/c/large_project/linux_red_heart/training/run_hierarchical_lr_sweep.py", line 110, in __getitem__
    raise RuntimeError(f"임베딩 생성 실패: {e}")
RuntimeError: 임베딩 생성 실패: 요청 실패 (재연결 없음): 응답 타임아웃 (780.0초)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/large_project/linux_red_heart/training/run_hierarchical_lr_sweep.py", line 491, in <module>
    results = main()
              ^^^^^^
  File "/mnt/c/large_project/linux_red_heart/training/run_hierarchical_lr_sweep.py", line 328, in main
    raise RuntimeError(f"임베딩 생성 실패. 인덱스: {idx}")
RuntimeError: 임베딩 생성 실패. 인덱스: 362
2025-08-21 22:32:58,775 - sentence_transformer_client - INFO - 서버 종료 중...
Terminated
[0;34m[INFO][0m 학습 시스템 정리 중...
[0;34m[INFO][0m GPU 메모리 정리...
[0;32m[SUCCESS][0m 정리 완료
