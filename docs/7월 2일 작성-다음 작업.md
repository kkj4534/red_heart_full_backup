# 7월 2일 작성 - 다음 작업 계획서

## 📌 개요

"7월 1일 2차 메모-개선안.md" 분석 결과를 바탕으로 한 체계적 작업 계획입니다.  
**법률 모드(LegalNormEvaluator)는 아직 고려 중이며, 차후 학습 완료 후 도입할 예정**입니다.
현재 phase 1 해결된 상태. 일단 phase 2인 학습을 진행해 봐야 함.
---

## 🎯 전체 작업 로드맵

### Phase 1: 시스템 안정화 및 기본 개선 (1-2일)
**목표**: 즉시 수정 가능한 핵심 문제 해결

| 순위 | 작업 항목 | 상세 내용 | 예상 시간 |
|------|-----------|-----------|-----------|
| 1 | EmotionVector 3D↔6D 헬퍼 구현 | `data_models.py`에 `to_3d()` 메소드 추가<br/>Bentham/Regret에 `dimension_mode` 플래그 | 2-3시간 |
| 2 | data_origin 태그 시스템 | 문학/실시간 데이터 구분 파이핑<br/>Phase0 Calibrator 조건부 가중치 | 3-4시간 |
| 3 | GPU 메모리 프로파일러 | `dynamic_gpu_manager.trace_gpu()` 30초 주기<br/>4-bit 캐시 강제 전환 트리거 | 4-5시간 |
| 4 | Experience DB 자동 정리 | Makefile target 작성<br/>`--top_k 20%` 상위 후회점수만 유지 | 2-3시간 |

### Phase 2: 시스템 전체 검증 및 학습 준비 (3-5일)
**목표**: 법률 모드 도입 이전 완전한 시스템 점검

#### 2-1. 시스템 전체 과정 확인 및 작동 테스트
- [ ] **통합 파이프라인 검증**
  - 감정 분석 → SURD → 벤담 계산 → 후회 학습 전체 플로우 테스트
  - Bridge Pattern 모든 어댑터 정상 작동 확인
  - 메모리 누수, 성능 병목 지점 식별
  
- [ ] **컴포넌트별 단위 테스트**
  - AdvancedEmotionAnalyzer: 문학/실시간 데이터 구분 처리
  - AdvancedBenthamCalculator: 경험 통합 계산 정확성
  - BayesianRegretSystem: 인지적 후회 + 하향 반사실적 + 피드백 전파
  - SURD + LLM 동기식 처리 안정성

#### 2-2. 학습 샘플 테스트
- [ ] **소규모 샘플 검증 (10-50개)**
  - 윤리적 딜레마 시나리오 10개로 기본 작동 확인
  - 감정-벤담-후회 점수 연관성 분석
  - 학습 수렴 패턴 관찰
  
- [ ] **중규모 샘플 테스트 (100-500개)**
  - 다양한 윤리 상황 유형별 성능 측정
  - 메모리 사용량, 처리 속도 벤치마킹
  - 후회 기반 시스템 개선 효과 정량화

#### 2-3. 샘플 기반 시간 추정 및 추가 수정 여부 확인
- [ ] **성능 메트릭 수집**
  - 샘플당 평균 처리 시간 측정
  - GPU/CPU 자원 사용률 프로파일링
  - Experience DB 증가율 및 정리 주기 최적화
  
- [ ] **시스템 안정성 평가**
  - 장시간 연속 실행 테스트 (6-12시간)
  - 메모리 누수 여부 확인
  - 오류 복구 메커니즘 검증
  
- [ ] **추가 수정 필요성 판단**
  - 성능 병목 지점 개선 우선순위 결정
  - 학습 데이터 품질 개선 방안 검토
  - 다음 단계 진행 가능성 최종 평가

#### 2-4. 학습 과정 최적화
- [ ] **학습 파라미터 튜닝**
  - 후회 학습 수렴 속도 최적화
  - 경험 메모리 가중치 밸런싱
  - 피드백 전파 강도 조정
  
- [ ] **학습 데이터 품질 향상**
  - 문학 코퍼스 vs 실시간 데이터 비율 조정
  - 윤리적 시나리오 다양성 확보
  - 편향 제거 및 균형 잡힌 학습 데이터 구성

### Phase 3: 고도화 및 확장 (1주)
**목표**: 인간 수준 후회 시스템 완성

| 순위 | 작업 항목 | 상세 내용 | 예상 시간 |
|------|-----------|-----------|-----------|
| 5 | Regret 모듈 인간화 | 행위/무행위, 의도성, 통제가능성 필드 추가 | 1-2일 |
| 6 | Bentham 다중 규범 지원 | deontic_score, virtue_score 보조 슬롯<br/>공리주의 편향 완화 로직 | 1-2일 |
| 7 | 윤리 벤치마크 프레임워크 | Trolley, Promise 등 20개 YAML 정의<br/>A/B 테스트 자동화 | 2-3일 |

---

## 🚧 법률 모드 (LegalNormEvaluator) - 차후 도입 예정

### 현재 상태
- **검토 중**: Gemma 2-9B LoRA 기반 설계안 분석
- **데이터셋**: Pile-of-Law, COLIEE 2025 전처리 방안 연구
- **통합 방식**: AdvancedSystemIntegration 후킹 구조 설계

### 도입 조건
1. ✅ **Phase 1-3 완료**: 기본 시스템 안정화 및 검증 완료
2. ✅ **학습 성능 확보**: 기존 3축(감정-벤담-후회) 시스템 수렴 확인
3. ✅ **리소스 여유 확보**: GPU 메모리 최적화 완료 (VRAM < 6GB 유지)
4. ✅ **벤치마크 통과**: 윤리 딜레마 테스트에서 80% 이상 정확도

### 예상 일정
- **Phase 4**: 법률 모드 설계 및 구현 (2-3주)
- **Phase 5**: 4축 통합 시스템 완성 (1주)

---

## 📊 성공 지표 및 체크포인트

### Phase 1 완료 기준
- [ ] 모든 차원 불일치 오류 해결 (0건)
- [ ] GPU 메모리 사용량 20% 감소
- [ ] Experience DB 크기 최적화 (상위 20% 유지)

### Phase 2 완료 기준
- [ ] 통합 테스트 100% 통과
- [ ] 500개 샘플 처리 시 안정성 확보
- [ ] 평균 처리 시간 < 2초/샘플
- [ ] 장시간 실행 시 메모리 누수 0%

### Phase 3 완료 기준
- [ ] 인간 후회 연구 기반 변수 적용 완료
- [ ] 20개 윤리 벤치마크 80% 이상 정확도
- [ ] 다중 규범 의사결정 균형 확보

---

## 🔧 기술적 구현 세부사항

### 1. EmotionVector 3D 헬퍼
```python
# data_models.py 확장 예시
@dataclass
class EmotionVector:
    dimensions_6d: List[float] = field(default_factory=lambda: [0.0]*6)
    
    def to_3d(self) -> List[float]:
        """6D → 3D 차원 축소 (VAD 모델)"""
        # Valence, Arousal, Dominance 축으로 변환
```

### 2. GPU 메모리 프로파일러
```python
# dynamic_gpu_manager.py 신규 모듈
class GPUMemoryProfiler:
    def trace_gpu(self, interval=30):
        """30초 주기 메모리 스파이크 감지"""
        # 임계치 초과 시 4-bit 캐시 강제 전환
```

### 3. Experience DB 정리 자동화
```makefile
# Makefile 추가 타겟
prune_experience:
	python scripts/prune_experience_db.py --top_k 20% --sort_by regret_score
```

---

## 📅 타임라인 요약

| 주차 | 주요 작업 | 핵심 목표 |
|------|-----------|-----------|
| 1주차 | Phase 1: 시스템 안정화 | 즉시 수정 가능한 문제 해결 |
| 2주차 | Phase 2: 전체 검증 및 학습 | 시스템 완전성 확보 |
| 3주차 | Phase 3: 고도화 확장 | 인간 수준 후회 시스템 완성 |
| 4주차+ | Phase 4-5: 법률 모드 도입 | 4축 통합 윤리 의사결정 시스템 |

---

## 💡 결론

현재 구현된 후회 시스템은 이미 **"사람 비슷한 후회+효용 계산" 루프**가 작동하는 상태입니다. 
다음 단계는 **시스템 안정화 → 전면 검증 → 인간화 고도화** 순서로 진행하여, 
법률 모드 도입 전에 견고한 기반을 구축하는 것이 목표입니다.

**우선 작업 시작점**: EmotionVector 3D 헬퍼 구현부터 시작하여 순차적으로 진행하겠습니다.