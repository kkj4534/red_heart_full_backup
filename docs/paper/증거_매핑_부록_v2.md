# 증거 매핑 부록 (업데이트 버전)

본 문서는 1장, 2장, 3장, 5장의 모든 핵심 주장을 실제 코드와 매핑한다.

## 1장 관련 증거

### 1.1 LLM 할루시네이션 및 과잉 동조

**[1-HALL-01] 할루시네이션 83% 발생률**
- 출처: Nature Communications 2025, Mount Sinai 연구
- 웹검색 검증: 2025년 1월 Communications Medicine 논문
- 요지: 6개 주요 LLM 의료 상담 시 최대 83% 할루시네이션

**[1-SYCO-01] GPT-4o 과잉 동조 문제**
- 출처: OpenAI 공식 발표, 2024년 4월 28일
- 웹검색 검증: Sam Altman 트위터, Sean Grove 언급
- 요지: 4월 25일 업데이트 후 심각한 sycophancy, 28일 롤백

**[1-LIMIT-01] 뉴럴 스케일링 법칙 한계**
- 출처: arXiv:2304.11082 (2023)
- 웹검색 검증: Behavior Expectation Bounds (BEB) 이론
- 요지: 다중 손실 함수 충돌로 윤리 정렬 실패

### 1.2 정서적 취약계층 연구

**[1-YOUTH-01] 청소년 AI 의존**
- 출처: "Illusions of Intimacy" arXiv 2025
- 웹검색 검증: 30,000개 대화 분석, 17.14% → 24.19% 의존 증가
- 요지: 젊은 남성, 부적응적 대처 방식

**[1-KOREA-01] 이루다 2.0 연구**
- 출처: UNIST 정두영, 고려대 조철현 교수팀
- 웹검색 검증: JMIR 2024년 발표, 176명 대학생 대상
- 요지: 외로움 15%, 사회불안 18% 감소

## 2장 관련 증거

### 2.1 EmotionDSP 시스템

**[2-DSP-01] 주파수 매핑 구현**
- 파일: emotion_dsp_simulator.py
- 위치: EMOTION_FREQUENCIES 상수 정의
- 라인: 주파수 매핑 테이블
- 요지: 7개 감정을 50-350Hz로 매핑

**[2-DSP-02] ADSR 엔벨로프**
- 파일: emotion_dsp_simulator.py
- 위치: apply_adsr_envelope 메소드
- 요지: Attack(0.1s)-Decay(0.2s)-Sustain(0.6)-Release(0.3s)

**[2-KALMAN-01] 칼만 필터링**
- 파일: emotion_dsp_simulator.py
- 위치: DynamicKalmanFilter 클래스
- 요지: Q=0.01, R=0.1로 노이즈 처리

### 2.2 계층적 감정 분석

**[2-HIER-01] 3단계 위계 구조**
- 파일: advanced_emotion_analyzer.py
- 위치: HierarchicalEmotionModel 임포트 (42-49행)
- 요지: Phase 0(개인) → Phase 1(타자) → Phase 2(공동체)

**[2-NEURAL-01] Neural Emotion Analyzer**
- 파일: analyzer_neural_modules.py
- 위치: NeuralEmotionAnalyzer 클래스
- 파라미터: 68M
- 요지: 3층 GRU, 7→28→112 감정 세분화

### 2.3 벤담 계산기

**[2-BENTH-01] 10차원 윤리 변수**
- 파일: advanced_bentham_calculator.py
- 위치: NeuralWeightPredictor.__init__ (60-96행)
- 요지: 전통 7차원 + 후회/공감/공정성

**[2-BENTH-02] 6층 재가중**
- 파일: analyzer_neural_modules.py
- 위치: NeuralBenthamCalculator (159-241행)
- 파라미터: 61M
- 요지: LayerNorm → Linear → ReLU → Dropout

### 2.4 후회 학습

**[2-REGR-01] 후회 유형 정의**
- 파일: advanced_regret_learning_system.py
- 위치: RegretType Enum (34-42행)
- 요지: 6가지 후회 유형 정의

**[2-REGR-02] 학습 페이즈**
- 파일: advanced_regret_learning_system.py
- 위치: LearningPhase Enum (43-48행)
- 요지: PHASE_0(자신) → PHASE_1(타자) → PHASE_2(공동체)

**[2-REGR-03] Neural Regret Analyzer**
- 파일: analyzer_neural_modules.py
- 위치: NeuralRegretAnalyzer (273-325행)
- 파라미터: 68M
- 요지: 7×3=21회 시나리오 계산

## 3장 관련 증거

### 3.1 시스템 워크플로우

**[3-MAIN-01] 시스템 초기화**
- 파일: main.py
- 위치: RedHeartSystem.initialize (248-313행)
- 요지: 10개 컴포넌트 병렬 초기화, 60초 타임아웃

**[3-MAIN-02] 5단계 처리**
- 파일: main.py
- 위치: analyze_async (704-759행)
- 요지: 입력→백본→헤드→Neural→통합

**[3-COORD-01] ModuleBridgeCoordinator**
- 파일: module_bridge_coordinator.py
- 위치: integrated_analysis 메소드
- 요지: 비동기 모듈 조율, 메모리 관리

### 3.2 파라미터 분배

**[3-PARAM-01] 730M 파라미터 구성**
- 파일: training/unified_training_final.py
- 위치: UnifiedTrainingConfig (63-116행)
- 라인 68: `model_params = 730_000_000`
- 요지: 정확한 파라미터 수 명시

**[3-PARAM-02] 모듈별 분배**
- 파일: training/unified_training_final.py
- 위치: UnifiedModel.__init__ (121-174행)
- 요지: 백본 90.6M, 헤드 153M, Neural 368M 등

### 3.3 백본과 헤드

**[3-BACK-01] Unified Backbone**
- 파일: unified_backbone.py
- 위치: RedHeartUnifiedBackbone 클래스
- 요지: 8층 트랜스포머, 14 헤드, d_model=896

**[3-HEAD-01] 4개 전문 헤드**
- 파일: unified_heads.py
- 위치: EmotionHead, BenthamHead, RegretHead, SURDHead
- 요지: 각 38.3M 파라미터

### 3.4 데이터 전처리

**[3-DATA-01] SCRUPLES 10,460개**
- 파일: claude_api_preprocessing/claude_preprocessed_complete.json
- 검증: Python 스크립트로 확인
- 요지: 101,052개 중 10.35% 선별

**[3-DATA-02] Claude API 전처리**
- 파일: claude_api_preprocessing/claude_complete_preprocessor.py
- 요지: Claude 3.5 Sonnet 일관 사용

**[3-DATA-03] 비용 절감**
- 파일: claude_api_preprocessing/README_COMPLETE.md
- 요지: Prompt Caching으로 $20→$2 (90% 절감)

**[3-DATA-04] 임베딩 청킹**
- 파일: claude_api_preprocessing/embedded/metadata.json
- 위치: 청크 정보 (6-95행)
- 요지: 11개 청크, 각 1,000개 (마지막 460개)

### 3.5 학습 시스템

**[3-TRAIN-01] 통합 학습 설정**
- 파일: training/unified_training_final.py
- 위치: UnifiedTrainingConfig (63-116행)
- 요지: 50 에폭, 배치 2, GA 32

**[3-TRAIN-02] Gradient Accumulation**
- 파일: training/unified_training_final.py
- 위치: 학습 루프 구현부
- 요지: 유효 배치 64 달성

**[3-TRAIN-03] Advanced Techniques**
- 파일: training/unified_training_final.py
- 라인 89-95: Label Smoothing, R-Drop, EMA, LLRD
- 요지: 4가지 최적화 기법 적용

### 3.6 최적화 시스템

**[3-SWEET-01] Sweet Spot Detection**
- 파일: training/sweet_spot_detector.py
- 위치: SweetSpotDetector.detect 메소드
- 요지: 3 에폭 연속 손실 증가 감지

**[3-CROSS-01] Parameter Crossover**
- 파일: training/parameter_crossover_system.py
- 위치: ParameterCrossoverSystem.crossover
- 요지: selective 전략으로 레이어별 최적 조합

**[3-OOM-01] OOM Handler**
- 파일: training/oom_handler.py
- 위치: OOMHandler 클래스
- 요지: 동적 배치 크기 조정

## 5장 관련 증거

### 5.1 현재 한계

**[5-LIMIT-01] GPU 메모리 제약**
- 파일: main.py
- 위치: _check_system_requirements (315-339행)
- 요지: 8GB VRAM 제약 확인

**[5-LIMIT-02] 멀티모달 미구현**
- 파일: TODO_목록.md
- 위치: TODO-05 항목
- 요지: 음성/표정/제스처 처리 미구현

**[5-LIMIT-03] 온라인 학습 미구현**
- 파일: TODO_목록.md
- 위치: TODO-01 항목
- 요지: 실시간 피드백 시스템 부재

### 5.2 개선 계획

**[5-IMPROVE-01] QLoRA 압축 계획**
- 파일: 5장_개선점_및_향후_연구_방향성.md
- 위치: 6.2.1절
- 요지: 730M → 200M (73% 감소)

**[5-IMPROVE-02] 문화권 커스터마이징**
- 파일: TODO_목록.md
- 위치: TODO-02 항목
- 요지: 문화별 가중치 테이블 필요

**[5-IMPROVE-03] 장기 메모리**
- 파일: TODO_목록.md
- 위치: TODO-03 항목
- 요지: 에피소드/시맨틱 메모리 구조

## 검증 도구

### 코드 위치 확인 스크립트

```python
#!/usr/bin/env python3
"""증거 매핑 검증 스크립트"""

import os
import re
from pathlib import Path

def verify_evidence(file_path, line_range=None):
    """파일과 라인 범위 검증"""
    if not Path(file_path).exists():
        return False, f"파일 없음: {file_path}"
    
    if line_range:
        with open(file_path, 'r') as f:
            lines = f.readlines()
            start, end = line_range
            if end > len(lines):
                return False, f"라인 범위 초과: {end} > {len(lines)}"
    
    return True, "검증 완료"

# 주요 증거 검증
evidence_map = {
    '[3-PARAM-01]': ('training/unified_training_final.py', (68, 68)),
    '[3-MAIN-01]': ('main.py', (248, 313)),
    '[2-DSP-01]': ('emotion_dsp_simulator.py', None),
    # ... 추가 증거
}

for evidence_id, (file_path, line_range) in evidence_map.items():
    valid, msg = verify_evidence(file_path, line_range)
    print(f"{evidence_id}: {'✅' if valid else '❌'} {msg}")
```

## 업데이트 이력

- 2025-08-25: 1장, 2장, 3장, 5장 기반 전면 개정
- 웹검색 검증 내용 추가
- 실제 라인 번호 확인 및 업데이트
- TODO 항목과 연계